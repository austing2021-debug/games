<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•¸æ•¸åŠ æ¸›æ³•</title>
    <style>
        body { margin: 0; font-family: "Varela Round", sans-serif; background: #fff8e1; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { padding: 10px; display: flex; justify-content: space-between; background: #ffecb3; }
        .btn { text-decoration: none; background: #ff6f00; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; border:none; font-size:1rem;}
        #game-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        
        .visual-equation { display: flex; align-items: center; font-size: 3rem; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px; }
        .item-group { display: flex; gap: 5px; background: white; padding: 10px; border-radius: 15px; border: 3px solid #ffca28; min-width: 60px; justify-content: center;}
        .item { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        .op { color: #5d4037; font-weight: bold; }

        .options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 100%; max-width: 400px; }
        .opt-btn { background: white; border: 3px solid #4db6ac; border-radius: 50%; width: 80px; height: 80px; font-size: 2rem; color: #00796b; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;}
        .opt-btn:active { background: #b2dfdb; transform: scale(0.9); }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="btn">â—€ å›é¦–é </a>
        <button class="btn" onclick="toggleMode()">åˆ‡æ›: <span id="modeText">åŠ æ³•</span></button>
    </header>

    <div id="game-area">
        <div class="visual-equation" id="eq"></div>
        <div class="options" id="opts"></div>
    </div>

    <div class="modal" id="modal" onclick="nextQ()">
        <h1 style="font-size:4rem; color:#4caf50;">å¥½æ£’! ğŸ‰</h1>
        <p>é»æ“Šè¢å¹•ä¸‹ä¸€é¡Œ</p>
    </div>

    <script>
        let isAdd = true;
        const icons = ['ğŸ', 'ğŸ¬', 'ğŸ¥', 'ğŸ„', 'â­', 'ğŸª'];
        
        function toggleMode() { isAdd = !isAdd; document.getElementById('modeText').innerText = isAdd ? "åŠ æ³•" : "æ¸›æ³•"; nextQ(); }
        window.onload = nextQ;

        function nextQ() {
            document.getElementById('modal').style.display = 'none';
            const icon = icons[Math.floor(Math.random() * icons.length)];
            let n1, n2, ans;
            
            if (isAdd) { // åŠ æ³•: ç¸½å’Œä¸è¶…é 10
                n1 = Math.floor(Math.random() * 5) + 1; 
                n2 = Math.floor(Math.random() * 5) + 1;
                ans = n1 + n2;
            } else { // æ¸›æ³•: è¢«æ¸›æ•¸ä¸è¶…é 10
                n1 = Math.floor(Math.random() * 5) + 3; // 3~7
                n2 = Math.floor(Math.random() * n1); // æ¯” n1 å°
                ans = n1 - n2;
            }

            // ç¹ªè£½
            const eqDiv = document.getElementById('eq');
            eqDiv.innerHTML = `
                <div class="item-group">${Array(n1).fill(`<div class="item">${icon}</div>`).join('')}</div>
                <div class="op">${isAdd ? '+' : '-'}</div>
                <div class="item-group">${Array(n2).fill(`<div class="item">${icon}</div>`).join('')}</div>
                <div class="op">=</div>
                <div class="item-group" style="border-style:dashed; border-color:#aaa;">?</div>
            `;

            // é¸é …
            const optsDiv = document.getElementById('opts');
            optsDiv.innerHTML = '';
            let choices = [ans];
            while(choices.length < 3) {
                let r = Math.floor(Math.random() * 10);
                if(!choices.includes(r) && r !== ans) choices.push(r);
            }
            choices.sort(() => Math.random() - 0.5);

            choices.forEach(c => {
                const btn = document.createElement('div');
                btn.className = 'opt-btn';
                btn.innerText = c;
                btn.onclick = () => {
                    if(c === ans) {
                        new AudioContext().createOscillator().start(); // ç°¡å–®éŸ³æ•ˆè§¸ç™¼
                        document.getElementById('modal').style.display = 'flex';
                    } else {
                        btn.style.background = '#ffcdd2';
                    }
                };
                optsDiv.appendChild(btn);
            });
        }
    </script>
</body>
</html>