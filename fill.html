<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çš®å…‹æ•æ•¸å­—å¡«ç©º</title>
    <style>
        :root { --bg: #f1f8e9; --brown: #5d4037; --green: #76c442; --hole: #3e2723; }
        body { margin: 0; background: var(--bg); font-family: "Varela Round", sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; user-select: none; touch-action: none;}
        header { padding: 10px; display: flex; justify-content: space-between; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10; }
        .btn { text-decoration: none; background: var(--green); color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; border: none; font-size: 1rem;}
        select { font-size: 1rem; padding: 5px; border-radius: 10px; border: 2px solid var(--green); color: var(--brown); font-weight: bold; background: white;}

        #game-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; width: 100%;}
        
        /* é¡Œç›®å€ (æ©‹æ¨‘) */
        .bridge-container { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; width: 95%; max-width: 600px; padding: 20px; background: rgba(255,255,255,0.5); border-radius: 20px; }
        .slot {
            width: 50px; height: 50px; background: #fff; border: 3px solid var(--brown); border-radius: 10px;
            display: flex; justify-content: center; align-items: center; font-size: 1.5rem; color: var(--brown); font-weight: bold;
            position: relative;
        }
        .slot.empty { background: #d7ccc8; border-style: dashed; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2); }
        .slot.filled { background: #c8e6c9; border: 3px solid var(--green); animation: pop 0.3s; }

        /* é¸é …å€ (æ‹–æ›³ç‰©) */
        .options-container {
            margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; height: 80px; width: 100%;
        }
        .draggable {
            width: 60px; height: 60px; background: #ffeb3b; border-radius: 50%; border: 3px solid #fbc02d;
            display: flex; justify-content: center; align-items: center; font-size: 1.8rem; color: var(--brown); font-weight: bold;
            cursor: grab; touch-action: none; position: relative; box-shadow: 0 4px 0 #f9a825; z-index: 100;
        }
        .draggable:active { transform: scale(1.1); box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 200; }
        
        @keyframes pop { 0% {transform: scale(0.5);} 80% {transform: scale(1.1);} 100% {transform: scale(1);} }
        .win-modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 300; }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="btn">â—€ åŸºåœ°</a>
        <select id="levelSelect" onchange="initGame()">
            <option value="0">1 - 10</option>
            <option value="1">11 - 20</option>
            <option value="2">21 - 30</option>
            <option value="3">31 - 40</option>
            <option value="4">41 - 50</option>
            <option value="5">51 - 60</option>
            <option value="6">61 - 70</option>
            <option value="7">71 - 80</option>
            <option value="8">81 - 90</option>
            <option value="9">91 - 100</option>
        </select>
    </header>

    <div id="game-area">
        <div class="bridge-container" id="bridge"></div>
        <div class="options-container" id="options"></div>
    </div>

    <div class="win-modal" id="winModal">
        <h1>ğŸ‰ ä¿®å¾©å®Œæˆï¼</h1>
        <button class="btn" onclick="nextLevel()" style="font-size:1.5rem; padding:10px 30px;">ä¸‹ä¸€é—œ</button>
    </div>

    <script>
        let currentLevel = 0;
        let missingNumbers = [];
        
        window.onload = initGame;

        function initGame() {
            const select = document.getElementById('levelSelect');
            currentLevel = parseInt(select.value);
            missingNumbers = [];
            document.getElementById('winModal').style.display = 'none';

            const startNum = currentLevel * 10 + 1;
            const endNum = startNum + 9;
            const bridge = document.getElementById('bridge');
            const options = document.getElementById('options');
            
            bridge.innerHTML = '';
            options.innerHTML = '';

            // éš¨æ©ŸæŒ– 3-5 å€‹æ´
            let sequence = [];
            for(let i=startNum; i<=endNum; i++) sequence.push(i);
            
            // éš¨æ©Ÿé¸å¹¾å€‹æ•¸å­—æŒ–ç©º
            let holes = 0;
            let maxHoles = 4; // æŒ–ç©ºæ•¸é‡
            
            sequence.forEach(num => {
                const slot = document.createElement('div');
                slot.classList.add('slot');
                
                // æ±ºå®šæ˜¯å¦æŒ–ç©º (æ©Ÿç‡ 40%)
                if(Math.random() < 0.45 && holes < maxHoles) {
                    slot.classList.add('empty');
                    slot.dataset.target = num;
                    slot.innerText = '?';
                    missingNumbers.push(num);
                    holes++;
                } else {
                    slot.innerText = num;
                }
                bridge.appendChild(slot);
            });

            // å¦‚æœé‹æ°£å¥½éƒ½æ²’æŒ–åˆ°ï¼Œå¼·åˆ¶æŒ–å¹¾å€‹
            if(missingNumbers.length === 0) {
                 // ç°¡å–®é‡æ•´
                 initGame();
                 return;
            }

            // ç”Ÿæˆæ‹–æ›³é¸é … (æ‰“äº‚)
            missingNumbers.sort(() => Math.random() - 0.5);
            missingNumbers.forEach(num => {
                const drag = document.createElement('div');
                drag.classList.add('draggable');
                drag.innerText = num;
                drag.dataset.val = num;
                
                // åŠ å…¥è§¸æ§/æ»‘é¼ äº‹ä»¶
                addDragEvents(drag);
                options.appendChild(drag);
            });
        }

        // --- æ‹–æ›³é‚è¼¯ (æ”¯æ´æ‰‹æ©Ÿ Touch) ---
        function addDragEvents(el) {
            let startX, startY, initialLeft, initialTop;
            
            const start = (e) => {
                // e.preventDefault(); // é¿å…æ²å‹• (è¦–æƒ…æ³é–‹å•Ÿ)
                const touch = e.type === 'touchstart' ? e.touches[0] : e;
                const rect = el.getBoundingClientRect();
                
                // è¨­å®šçµ•å°å®šä½ä»¥ä¾¿ç§»å‹•
                el.style.position = 'fixed'; // ä½¿ç”¨ fixed é˜²æ­¢è¢«å®¹å™¨è£åˆ‡
                el.style.left = rect.left + 'px';
                el.style.top = rect.top + 'px';
                el.style.zIndex = 1000;
                
                startX = touch.clientX;
                startY = touch.clientY;
                initialLeft = rect.left;
                initialTop = rect.top;
                
                playPop();
            };

            const move = (e) => {
                if (el.style.position !== 'fixed') return;
                e.preventDefault();
                const touch = e.type === 'touchmove' ? e.touches[0] : e;
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;
                el.style.left = (initialLeft + dx) + 'px';
                el.style.top = (initialTop + dy) + 'px';
            };

            const end = (e) => {
                if (el.style.position !== 'fixed') return;
                const touch = e.type === 'touchend' ? e.changedTouches[0] : e;
                
                // æª¢æŸ¥æ˜¯å¦å°æº–ç›®æ¨™
                // éš±è—è‡ªå·±ä¸€ä¸‹ï¼Œä¸ç„¶ elementFromPoint æœƒæŠ“åˆ°è‡ªå·±
                el.style.display = 'none';
                let target = document.elementFromPoint(touch.clientX, touch.clientY);
                el.style.display = 'flex';

                if (target && target.classList.contains('empty') && !target.classList.contains('filled')) {
                    if (parseInt(target.dataset.target) === parseInt(el.dataset.val)) {
                        // ç­”å°ï¼
                        target.innerText = el.dataset.val;
                        target.classList.remove('empty');
                        target.classList.add('filled');
                        playCorrect();
                        el.remove(); // ç§»é™¤é¸é …
                        checkWin();
                        return;
                    } else {
                        playWrong();
                    }
                }

                // æ²’å°æº–æˆ–ç­”éŒ¯ï¼Œå½ˆå›å»
                el.style.position = 'static';
                el.style.zIndex = 100;
                el.style.left = 'auto';
                el.style.top = 'auto';
            };

            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', start, {passive: false});
            
            document.addEventListener('mousemove', move);
            document.addEventListener('touchmove', move, {passive: false});
            
            el.addEventListener('mouseup', end);
            el.addEventListener('touchend', end);
        }

        function checkWin() {
            const remaining = document.querySelectorAll('.draggable');
            if(remaining.length === 0) {
                setTimeout(() => {
                    document.getElementById('winModal').style.display = 'flex';
                    playWin();
                }, 500);
            }
        }

        function nextLevel() {
            const select = document.getElementById('levelSelect');
            if(select.selectedIndex < 9) select.selectedIndex++;
            initGame();
        }

        // --- éŸ³æ•ˆ ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, type='sine', dur=0.1) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq;
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + dur); osc.stop(audioCtx.currentTime + dur);
        }
        function playPop() { playTone(400, 'triangle', 0.05); }
        function playCorrect() { playTone(800, 'sine', 0.1); setTimeout(()=>playTone(1200, 'sine', 0.2), 100); }
        function playWrong() { playTone(150, 'sawtooth', 0.3); }
        function playWin() { 
            [523, 659, 784, 1046].forEach((f, i) => setTimeout(()=>playTone(f, 'square', 0.2), i*150)); 
        }
    </script>
</body>
</html>