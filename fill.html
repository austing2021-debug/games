<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>數字填空</title>
    <style>
        body { margin: 0; font-family: "Varela Round", sans-serif; background: #f1f8e9; display: flex; flex-direction: column; height: 100vh; overflow: hidden; touch-action: none; }
        header { padding: 10px; background: white; display: flex; gap: 10px; z-index: 10; }
        .btn { padding: 5px 15px; background: #76c442; color: white; border-radius: 15px; text-decoration: none; border:none; font-size:1rem;}
        select { font-size: 1rem; }
        
        #board { flex: 1; display: flex; flex-wrap: wrap; gap: 5px; padding: 20px; align-content: flex-start; justify-content: center; overflow-y: auto;}
        .cell { width: 50px; height: 50px; border: 2px solid #5d4037; background: white; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: bold; border-radius: 8px; }
        .empty { background: #d7ccc8; border-style: dashed; }
        .filled { background: #c8e6c9; color: #33691e; }
        
        #drags { height: 100px; background: #e8f5e9; border-top: 2px solid #ccc; display: flex; align-items: center; gap: 10px; overflow-x: auto; padding: 0 10px; }
        .drag-item { width: 60px; height: 60px; background: #ffeb3b; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: bold; flex-shrink: 0; box-shadow: 2px 2px 0 #fbc02d; }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="btn">◀</a>
        <select id="rangeSel" onchange="init()">
            <option value="0">1-50</option>
            <option value="50">51-100</option>
        </select>
        <button class="btn" onclick="init()">新題目</button>
    </header>

    <div id="board"></div>
    <div id="drags"></div>

    <script>
        window.onload = init;
        let dragging = null;

        function init() {
            const start = parseInt(document.getElementById('rangeSel').value) + 1;
            const board = document.getElementById('board');
            const drags = document.getElementById('drags');
            board.innerHTML = ''; drags.innerHTML = '';

            // 產生 50 個數字
            let nums = [];
            for(let i=0; i<50; i++) nums.push(start + i);

            // 隨機決定挖空數量 (3-10)
            let holeCount = Math.floor(Math.random() * 8) + 3;
            let holes = [];
            while(holes.length < holeCount) {
                let idx = Math.floor(Math.random() * 50);
                if(!holes.includes(idx)) holes.push(idx);
            }

            // 建立格子
            nums.forEach((n, i) => {
                const div = document.createElement('div');
                div.className = 'cell';
                if(holes.includes(i)) {
                    div.className += ' empty';
                    div.dataset.ans = n;
                    // 建立對應的拖曳物
                    createDrag(n);
                } else {
                    div.innerText = n;
                }
                board.appendChild(div);
            });
            
            // 打亂拖曳物
            shuffleDrags();
        }

        function createDrag(n) {
            const d = document.createElement('div');
            d.className = 'drag-item';
            d.innerText = n;
            d.dataset.val = n;
            
            // 觸控邏輯
            d.addEventListener('touchstart', e => {
                e.preventDefault();
                dragging = d;
                d.style.position = 'fixed';
                d.style.zIndex = 100;
                moveDrag(e.touches[0]);
            });
            d.addEventListener('touchmove', e => {
                if(dragging) moveDrag(e.touches[0]);
            });
            d.addEventListener('touchend', e => {
                const touch = e.changedTouches[0];
                d.style.display = 'none'; // 隱藏以偵測下方元素
                const elem = document.elementFromPoint(touch.clientX, touch.clientY);
                d.style.display = 'flex';
                
                if(elem && elem.classList.contains('empty') && !elem.innerText) {
                    if(parseInt(elem.dataset.ans) === parseInt(d.innerText)) {
                        elem.innerText = d.innerText;
                        elem.className = 'cell filled';
                        d.remove();
                    }
                }
                d.style.position = 'static';
                dragging = null;
            });
            document.getElementById('drags').appendChild(d);
        }

        function moveDrag(t) {
            dragging.style.left = (t.clientX - 30) + 'px';
            dragging.style.top = (t.clientY - 30) + 'px';
        }

        function shuffleDrags() {
            const d = document.getElementById('drags');
            for (let i = d.children.length; i >= 0; i--) {
                d.appendChild(d.children[Math.random() * i | 0]);
            }
        }
    </script>
</body>
</html>
