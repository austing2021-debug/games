<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çš®å…‹æ•å°‹æ‰¾å¤¥ä¼´</title>
    <style>
        :root {
            --bg-grass: #e8f5e9;
            --soil-dark: #3e2723;
            --card-back: #4caf50;
            --pikmin-yellow: #ffd700;
        }
        body {
            margin: 0; font-family: "Varela Round", sans-serif;
            background-color: var(--bg-grass);
            background-image: radial-gradient(#c8e6c9 20%, transparent 20%);
            background-size: 30px 30px;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden; user-select: none;
        }
        header { margin: 10px; display: flex; gap: 10px; align-items: center; z-index: 10;}
        .home-btn {
            text-decoration: none; background: white; padding: 8px 15px; border-radius: 20px;
            font-weight: bold; color: var(--soil-dark); border: 2px solid var(--soil-dark);
        }
        
        /* é›£åº¦é¸å–® */
        .difficulty-menu {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.95); z-index: 50;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .diff-btn {
            margin: 10px; padding: 15px 40px; font-size: 1.5rem; border-radius: 30px;
            border: none; background: var(--pikmin-yellow); color: var(--soil-dark);
            font-weight: bold; cursor: pointer; box-shadow: 0 5px 0 #fbc02d;
        }
        .diff-btn:active { transform: translateY(5px); box-shadow: none; }

        .game-board {
            display: grid; gap: 5px; width: 95%; max-width: 500px;
            aspect-ratio: 1; /* æ­£æ–¹å½¢ */
            margin-top: 10px;
        }
        
        .card {
            background: white; border-radius: 8px; cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.4s;
            border: 2px solid var(--soil-dark); display: flex; justify-content: center; align-items: center;
        }
        .card.flipped { transform: rotateY(180deg); border-color: #ffd700; }
        .card-front, .card-back {
            position: absolute; backface-visibility: hidden; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center; border-radius: 6px;
        }
        .card-front { transform: rotateY(180deg); background: white; font-size: 1.5rem; }
        .card-back { background: var(--soil-dark); font-size: 1.2rem; }
        
        /* å‹•æ…‹èª¿æ•´å­—é«”å¤§å° */
        .grid-4 .card-front { font-size: 2.5rem; }
        .grid-6 .card-front { font-size: 1.8rem; }
        .grid-8 .card-front { font-size: 1.2rem; }

        .win-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); display: none;
            flex-direction: column; justify-content: center; align-items: center; z-index: 100;
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="home-btn">â—€ åŸºåœ°</a>
        <button class="home-btn" onclick="showMenu()">é‡é¸é›£åº¦</button>
    </header>

    <div class="difficulty-menu" id="menu">
        <h1>ğŸŒ± é¸æ“‡åœ°åœ–å¤§å°</h1>
        <button class="diff-btn" onclick="startGame(4)">4 x 4 (ç°¡å–®)</button>
        <button class="diff-btn" onclick="startGame(6)">6 x 6 (ä¸­ç­‰)</button>
        <button class="diff-btn" onclick="startGame(8)">8 x 8 (å›°é›£)</button>
    </div>

    <div class="game-board" id="board"></div>

    <div class="win-modal" id="winModal">
        <h1 style="font-size:3rem; margin:0;">ğŸ‰ å°‹æ‰¾æˆåŠŸ!</h1>
        <button class="diff-btn" onclick="showMenu()">ä¸‹ä¸€é—œ</button>
    </div>

    <script>
        // å¤§é‡æ“´å……çš„ Emoji åº« (è¶…é 40 ç¨®ä»¥æ”¯æ´ 8x8=64 æ ¼ -> 32 å°)
        const allEmojis = [
            'ğŸ”´','ğŸ”µ','ğŸŸ¡','ğŸª¨','ğŸŸ£','âšª','ğŸ§Š','ğŸ¦‹', 
            'ğŸ„','ğŸŒ¸','ğŸŒ·','ğŸŒ»','ğŸ€','ğŸ','ğŸ','ğŸŠ',
            'ğŸ','ğŸ','ğŸ›','ğŸœ','ğŸŒ','ğŸ¢','ğŸ¦','ğŸ¸',
            'ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼',
            'â­','ğŸŒ™','â˜€ï¸','âš¡','ğŸ’§','ğŸ”¥','ğŸª','ğŸš€'
        ];
        
        let flippedCards = [];
        let matchedPairs = 0;
        let isLocked = false;
        let totalPairs = 0;

        function showMenu() {
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('winModal').style.display = 'none';
        }

        function startGame(size) {
            document.getElementById('menu').style.display = 'none';
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            // è¨­å®š CSS Grid
            board.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            board.className = `game-board grid-${size}`;

            matchedPairs = 0;
            totalPairs = (size * size) / 2;
            flippedCards = [];
            isLocked = false;

            // é¸å–éœ€è¦çš„ emoji æ•¸é‡
            let selectedEmojis = allEmojis.slice(0, totalPairs);
            let gameItems = [...selectedEmojis, ...selectedEmojis];
            gameItems.sort(() => Math.random() - 0.5);

            gameItems.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `
                    <div class="card-back">ğŸŒ±</div>
                    <div class="card-front">${item}</div>
                `;
                card.addEventListener('click', () => flipCard(card, item));
                board.appendChild(card);
            });
        }

        function flipCard(card, item) {
            if (isLocked || card.classList.contains('flipped')) return;

            card.classList.add('flipped');
            flippedCards.push({ card, item });
            playTone(600);

            if (flippedCards.length === 2) checkMatch();
        }

        function checkMatch() {
            isLocked = true;
            const [first, second] = flippedCards;

            if (first.item === second.item) {
                flippedCards = [];
                isLocked = false;
                matchedPairs++;
                setTimeout(() => playTone(880), 200);

                if (matchedPairs === totalPairs) {
                    setTimeout(() => {
                        document.getElementById('winModal').style.display = 'flex';
                    }, 500);
                }
            } else {
                setTimeout(() => {
                    first.card.classList.remove('flipped');
                    second.card.classList.remove('flipped');
                    flippedCards = [];
                    isLocked = false;
                }, 800);
            }
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.value = freq;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.stop(audioCtx.currentTime + 0.2);
        }
    </script>
</body>
</html>
