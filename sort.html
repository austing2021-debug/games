<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>排序整理</title>
    <style>
        body { margin: 0; background: #fff3e0; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; touch-action: none;}
        header { padding: 10px; background: white; display: flex; gap: 10px; z-index: 10; align-items: center;}
        .btn { padding: 5px 15px; background: #ff9800; color: white; border-radius: 15px; text-decoration: none; border:none; cursor: pointer;}
        
        #slots-area { flex: 1; display: flex; flex-wrap: wrap; justify-content: center; padding: 20px; gap: 10px; align-content: center;}
        .slot { width: 60px; height: 80px; background: #efebe9; border: 2px dashed #8d6e63; border-radius: 10px; display: flex; justify-content: center; align-items: center; position: relative;}
        .slot::after { content: attr(data-idx); position: absolute; bottom: -20px; color: #aaa; font-size: 0.8rem;}
        
        #items-area { height: 120px; background: #ffe0b2; display: flex; align-items: center; justify-content: center; gap: 10px; overflow-x: auto; }
        .item { width: 50px; height: 50px; background: #ff5722; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: bold; z-index: 100;}
        
        .correct { border-color: #4caf50; background: #e8f5e9; }
        .wrong { border-color: #f44336; background: #ffebee; }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="btn">◀</a>
        <select id="countSel">
            <option value="3">3格</option>
            <option value="5" selected>5格</option>
            <option value="10">10格</option>
            <option value="15">15格</option>
        </select>
        <button class="btn" onclick="init()">重置</button>
        <button class="btn" style="background:#4caf50" onclick="check()">檢查</button>
    </header>

    <div id="slots-area"></div>
    <div id="items-area"></div>

    <script>
        let correctOrder = [];
        window.onload = init;

        function init() {
            const count = parseInt(document.getElementById('countSel').value);
            const slots = document.getElementById('slots-area');
            const items = document.getElementById('items-area');
            slots.innerHTML = ''; items.innerHTML = '';

            // 生成數字
            let nums = [];
            while(nums.length < count) {
                let r = Math.floor(Math.random()*100)+1;
                if(!nums.includes(r)) nums.push(r);
            }
            correctOrder = [...nums].sort((a,b)=>a-b);

            // 建立插槽
            for(let i=0; i<count; i++) {
                let s = document.createElement('div');
                s.className = 'slot';
                s.dataset.idx = i+1;
                slots.appendChild(s);
            }

            // 建立拖曳球
            nums.forEach(n => {
                let d = document.createElement('div');
                d.className = 'item';
                d.innerText = n;
                // 簡易拖曳
                d.ontouchstart = e => {
                    e.preventDefault();
                    d.style.position = 'fixed';
                    move(d, e.touches[0]);
                };
                d.ontouchmove = e => move(d, e.touches[0]);
                d.ontouchend = e => drop(d, e.changedTouches[0]);
                items.appendChild(d);
            });
        }

        function move(el, t) {
            el.style.left = (t.clientX - 25) + 'px';
            el.style.top = (t.clientY - 25) + 'px';
        }

        function drop(el, t) {
            el.style.display = 'none';
            let target = document.elementFromPoint(t.clientX, t.clientY);
            el.style.display = 'flex';
            
            if(target && target.classList.contains('slot') && target.children.length === 0) {
                el.style.position = 'static';
                target.appendChild(el);
            } else {
                // 回到底部
                el.style.position = 'static';
                document.getElementById('items-area').appendChild(el);
            }
        }

        function check() {
            const slots = document.querySelectorAll('.slot');
            let allCorrect = true;
            slots.forEach((s, i) => {
                if(s.children.length > 0) {
                    const val = parseInt(s.children[0].innerText);
                    if(val === correctOrder[i]) {
                        s.className = 'slot correct';
                    } else {
                        s.className = 'slot wrong';
                        allCorrect = false;
                    }
                } else {
                    allCorrect = false;
                }
            });
            if(allCorrect) alert("太棒了！順序正確！");
        }
    </script>
</body>
</html>
